!function(a,b){"function"==typeof define&&define.amd?define(["type-factory","mitty","jquery"],b):"object"==typeof module&&module.exports?module.exports=b(require("type-factory"),require("mitty"),require("jquery")):a.SimpleView=b(a.typeFactory,a.mitty,a.jQuery)}(this,function(a,b,c){var d=0,e=/{{(\S+)}}/g,f=function(a,b){return a.replace(e,function(a,c){var d=0===c.indexOf("this."),e=d?b:window,f=(d?c.slice(5):c).split(".");for(var g in f)if(e=e[f[g]],"undefined"==typeof e)throw new Error("Undefined variable in event string");return e})},g={document:window.document,window:window},h=a({delegatedEvents:!0,parseEventVariables:!0,assignOptions:!1,constructor:function(a){if(this.cid="view"+ ++d,a&&a.$el&&(this.$el=a.$el instanceof c?a.$el:c(a.$el).eq(0),delete a.$el),this.assignOptions){var b="function"==typeof this.defaults?this.defaults():this.defaults;this.options="deep"===this.assignOptions?c.extend(!0,{},b,a):c.extend({},b,a)}this.beforeInitialize&&this.beforeInitialize.apply(this,arguments),this.initialize&&this.initialize.apply(this,arguments),this.events&&this.$el&&this.setupEvents()},setupEvents:function(a){var b=a||this.events,d="function"==typeof b?b.call(this):b,e=this;if(d){var h=this.ens=this.ens||"."+this.cid;c.each(d,function(a,b){e.parseEventVariables&&(a=f(a,e));var d=0===a.indexOf("one:"),i=(d?a.slice(4):a).split(" "),j=i[0]+h,k=i.slice(1).join(" "),l=e.$el;g[k]?(l=e["$"+k]=e["$"+k]||c(g[k]),k=void 0):e.delegatedEvents||((e.elementsWithBoundEvents=e.elementsWithBoundEvents||[]).push(l=l.find(k)),k=void 0),l[d?"one":"on"](j,k,function(){("function"==typeof b?b:e[b]).apply(e,arguments)})})}return this},removeEvents:function(){var a=this.ens;return a&&(this.$el&&this.$el.off(a),this.$document&&this.$document.off(a),this.$window&&this.$window.off(a),this.elementsWithBoundEvents&&(c.each(this.elementsWithBoundEvents,function(b,d){c(d).off(a)}),delete this.elementsWithBoundEvents),delete this.dismissListeners),this},addDismissListener:function(a,b){var d=this;if(!a)throw new Error("Dismiss listener name not speficied");return b=c.extend({$el:this.$el},b),this.$document=this.$document||c(document),this.ens=this.ens||"."+this.cid,this.dismissListeners=this.dismissListeners||{},this.dismissListeners[a]||(this.dismissListeners[a]=function(e){27!==e.keyCode&&(c(e.target).is(b.$el)||c.contains(b.$el.get(0),e.target))||d[a].call(d)},this.$document.on("click"+this.ens+" keyup"+this.ens,this.dismissListeners[a])),this},removeDismissListener:function(a){if(!a)throw new Error("Name of dismiss listener to remove not specified");return this.dismissListeners&&this.dismissListeners[a]&&(this.$document.off("click keyup",this.dismissListeners[a]),delete this.dismissListeners[a]),this},remove:function(){return this.trigger("beforeRemove"),this.removeEvents().abortDeferreds().removeViews(),this.$el&&this.$el.remove(),this.trigger("afterRemove"),this.off().stopListening(),this},addDeferred:function(a){return this.deferreds=this.deferreds||[],(!Array.prototype.indexOf||this.deferreds.indexOf(a)<0)&&this.deferreds.push(a),a},abortDeferreds:function(){return this.deferreds&&c.each(this.deferreds,function(a,b){"object"==typeof b&&b.state&&"pending"===b.state()&&(b.abort?b.abort():b.reject())}),delete this.deferreds,this},when:function(a,b,d){var e=this;return c.each(a=c.isArray(a)?a:[a],function(a,b){e.addDeferred(b)}),c.when.apply(c,a).done(c.proxy(b,this)).fail(c.proxy(d,this))},addView:function(a){return this.views=this.views||{},this.views[a.cid]=a,this.listenTo(a,"afterRemove",function(){delete this.views[a.cid]}),a},mapView:function(a,b,d){var e=("string"==typeof a?this.$(a):c(a)).eq(0);return e.length?this.addView(new b(c.extend({$el:e},d))):void 0},mapViews:function(a,b,d){var e=this,f="string"==typeof a?this.$(a):c(a);return f.map(function(a,f){return e.addView(new b(c.extend({$el:c(f)},d)))}).get()},mapViewsAsync:function(a,b,d){var e=this,f=c.Deferred(),g="string"==typeof a?this.$(a):c(a);return g.length?b(function(a){f.resolve(e.mapViews(g,a,d))}):f.resolve([]),f},removeViews:function(){return this.views&&c.each(this.views,function(a,b){b.remove()}),delete this.views,this},$:function(a){return this.$el.find(a)}});return b(h.prototype),h});