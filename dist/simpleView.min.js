!function(e,i){"function"==typeof define&&define.amd?define(["type-factory","mitty","jquery"],i):"object"==typeof module&&module.exports?module.exports=i(require("type-factory"),require("mitty"),require("jquery")):e.SimpleView=i(e.typeFactory,e.mitty,e.jQuery)}(this,function(e,i,t){var s=0,n=/{{\s*(\S+)\s*}}/g,o=function(e,i){return e.replace(n,function(e,t){var s=i,n=t.slice(5).split(".");for(var o in n)if(void 0===(s=s[n[o]]))throw new Error("Undefined variable in event string");return s})},r={document:window.document,window:window},h=e({delegatedEvents:!0,parseEventVariables:!0,constructor:function(e){this.cid="view"+ ++s,e&&e.$el&&(this.$el=e.$el instanceof t?e.$el:t(e.$el).eq(0),delete e.$el),this.assignOptions&&(this.writeOptions.apply(this,arguments),this.optionRules&&this.validateOptions(this.options,this.optionRules)),this.beforeInitialize&&this.beforeInitialize.apply(this,arguments),this.initialize&&this.initialize.apply(this,arguments),this.events&&this.$el&&this.setupEvents()},setupEvents:function(e){var i=e||this.events,s="function"==typeof i?i.call(this):i,n=this;if(s){var h=this.ens=this.ens||"."+this.cid;t.each(s,function(e,i){n.parseEventVariables&&(e=o(e,n));var s=0===e.indexOf("one:"),d=(s?e.slice(4):e).split(" "),u=d[0]+h,f=d.slice(1).join(" "),l=n.$el;r[f]?(l=n["$"+f]=n["$"+f]||t(r[f]),f=void 0):n.delegatedEvents||((n.elementsWithBoundEvents=n.elementsWithBoundEvents||[]).push(l=l.find(f)),f=void 0),l[s?"one":"on"](u,f,function(){("function"==typeof i?i:n[i]).apply(n,arguments)})})}return this},removeEvents:function(){var e=this.ens;return e&&(this.$el&&this.$el.off(e),this.$document&&this.$document.off(e),this.$window&&this.$window.off(e),this.elementsWithBoundEvents&&(t.each(this.elementsWithBoundEvents,function(i,s){t(s).off(e)}),delete this.elementsWithBoundEvents),delete this.dismissListeners),this},addDismissListener:function(e,i){var s=this;if(!e)throw new Error("Dismiss listener name not speficied");return i=t.extend({$el:this.$el},i),this.$document=this.$document||t(document),this.ens=this.ens||"."+this.cid,this.dismissListeners=this.dismissListeners||{},this.dismissListeners[e]||(this.dismissListeners[e]=function(n){27!==n.keyCode&&(t(n.target).is(i.$el)||t.contains(i.$el.get(0),n.target))||s[e].call(s)},this.$document.on("click"+this.ens+" keyup"+this.ens,this.dismissListeners[e])),this},removeDismissListener:function(e){if(!e)throw new Error("Name of dismiss listener to remove not specified");return this.dismissListeners&&this.dismissListeners[e]&&(this.$document.off("click keyup",this.dismissListeners[e]),delete this.dismissListeners[e]),this},remove:function(){return this.trigger("beforeRemove"),this.removeEvents().removeViews(),this.$el&&this.$el.remove(),this.trigger("afterRemove"),this.off().stopListening(),this},addView:function(e){return this.views=this.views||{},this.views[e.cid]=e,this.listenTo(e,"afterRemove",function(){delete this.views[e.cid]}),e},mapView:function(e,i,s){var n=("string"==typeof e?this.$(e):t(e)).eq(0);return n.length?this.addView(new i(t.extend({$el:n},s))):void 0},mapViews:function(e,i,s){var n=this;return("string"==typeof e?this.$(e):t(e)).map(function(e,o){return n.addView(new i(t.extend({$el:t(o)},s)))}).get()},removeViews:function(){return this.views&&t.each(this.views,function(e,i){i.remove()}),delete this.views,this},$:function(e){return this.$el.find(e)}});return i(h.prototype),h});